import React, { useState } from 'react';
import { withRouter } from 'react-router-dom';
import { connect } from 'react-redux';
import { updateSearch, fetchSearch } from 'actions';

const Search = props => {
  const { fetchSearch, history, updateSearch, query } = props;
  const [value, changeValue] = useState(query);

  const handleChange = event => {
    changeValue(event.target.value);
  };
  const handleSubmit = event => {
    event.preventDefault();
    updateSearch(value);
    fetchSearch(value);
    history.push('/search')
  };
  return (
    <div className="container">
      <div className="search">
        <form onSubmit={handleSubmit} className="search__form">
          <div className="search__form__field">
          <input 
            type="text"
            className="search__form__field__input"
            onChange={handleChange}
            defaultValue={query}
            placeholder="Search for applications..."
          />
          <button type="submit" >
            <svg className="svg-icon">
                  <use
                    xlinkHref="/uploads/sprite.svg#icon-search"     
                  />
            </svg>
          </button>
          </div>
        </form>
      </div>
    </div>
  )
}

const mapStateToProps = ({ searchPage }) => ({
  query: searchPage.search
});

const mapDispatchToProps = {
  updateSearch,
  fetchSearch
};

export default connect(mapStateToProps, mapDispatchToProps)(withRouter(Search));
